<!DOCTYPE html>
<html>

<head>
    <title>NicE Buoy</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="discription" content="NicE buoy remote controller">
    <link rel="stylesheet" type="text/css" href="style.css">
    <title>NicE buoy remote controller!!!</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="data:,">
</head>

<body>
    <header>
        <div class="topnav">
            <h1>NicE buoy remote controller</h1>
        </div>

        <div class="card">
            <div class="container">
                <div class="barcontainer">
                    <div class="bar" id="bb1" style="height:70%">
                    </div>
                </div>
                <div class=" barcontainer">
                    <div class="bar" id="sb1" style="height:70%">
                    </div>
                </div>

                <h2>
                    Buoy 1
                </h2>
                <button id="LOOK_Buoy_1" class="button"
                    onclick="myFunctionLock1()">Locked off</button>
                <button id="Remote_Buoy_1" class="button"
                    onclick="myFunctionRemote1()">Remote off</button>
                <button id="Doc_Buoy_1" class="button"
                    onclick="myFunctionDoc1()">Doc off</button>


                <p class="switch">BB
                    <input type="range" onchange="Rudder1(this.value)"
                        id="Rudder1" min="-180" max="180" step="10" value="0"
                        class="slider">SB
                </p>
                <p class="state">Rudder: <span id="rudder1"></span>
                    &deg;</p>

                << <input type="range" onchange="Speed1(this.value)" id="Speed1"
                    min="-100" max="100" step="10" value="0" class="slider">>>
                    </p>

                    <p class="state">Throttle: <span id="speed1"></span>
                        &percnt;</p>
            </div>
            <h2>
                <p>Heading:<span id="mdir1"></span>&deg; Target:<span
                        id="tdir1"></span>&deg; Target:<span
                        id="tgdistance1"></span>M </p>
                <p class="rssi1"> Rssi:<span id="rssi1"></span>dBm</p>
            </h2>
        </div>

        <h3> Status: <div id="status"> Status window </div>
        </h3>



    </header>
    <script>


        //var gateway = `ws://${window.location.hostname}/ws`;
        //var gateway = `ws://192.168.178.132/ws`;
        var gateway = `ws://192.168.1.24/ws`;
        var websocket;
        window.addEventListener("load", onLoad);

        function move() {
            var elem = document.getElementById("myBar");
            var width = 1;
            var id = setInterval(frame, 10);
            function frame() {
                if (width >= 100) {
                    clearInterval(id);
                } else {
                    width++;
                    elem.style.width = width + '%';
                }
            }
        }




        function getValues() {
            websocket.send("getValues");
        }
        function initWebSocket() {
            console.log("Trying to open a WebSocket connection...");
            websocket = new WebSocket(gateway);
            websocket.onopen = onOpen;
            websocket.onclose = onClose;
            websocket.onmessage = onMessage; // <-- add this line
        }
        function onOpen(event) {
            console.log("Connected");
            toStatus("Connected");
            getValues();
        }
        function onClose(event) {
            console.log("Connection closed");
            toStatus("Connection closed");
            setTimeout(initWebSocket, 2000);
        }
        function onMessage(event) {
            console.log(event);
            //toStatus(event.data);
            var stuff = JSON.parse(event.data);
            var val = stuff["speed1"];
            if (val != undefined) {
                document.getElementById("Speed1").value = val;
                document.getElementById("speed1").innerHTML = val;
            }
            var val = stuff["ddir1"];
            if (val != undefined) {
                document.getElementById("Rudder1").value = val;
                document.getElementById("rudder1").innerHTML = val;
            }
            var val = stuff["tgdir1"];
            if (val != undefined) {
                document.getElementById("tdir1").innerHTML = val;
            }
            var val = stuff["mdir1"];
            if (val != undefined) {
                document.getElementById("mdir1").innerHTML = val;
            }
            var val = stuff["rssi1"];
            if (val != undefined) {
                document.getElementById("rssi1").innerHTML = val;
            }
            var val = stuff["tgdistance1"];
            if (val != undefined) {
                document.getElementById("tgdistance1").innerHTML = val;
            }
            var val = stuff["speedbb1"];
            if (val != undefined) {
                document.getElementById("bb1").innerHTML = val + "%";
                document.getElementById("bb1").style = "height:" + val + "%";
            }
            var val = stuff["speedsb1"];
            if (val != undefined) {
                document.getElementById("sb1").innerHTML = val + "%";
                document.getElementById("sb1").style = "height:" + val + "%";
            }

        }

        function onLoad(event) {
            initWebSocket();
            toStatus("No connection");
        }

        function myFunctionLock1() {
            var x = document.getElementById("LOOK_Buoy_1");
            if (x.innerHTML === "Locked off") {
                x.innerHTML = "Locked on";
                websocket.send(JSON.stringify({ LOCKEDBUOY1: true }));

                var x = document.getElementById("Remote_Buoy_1");
                x.innerHTML = "Remote off";
                var x = document.getElementById("Doc_Buoy_1");
                x.innerHTML = "Doc off";

            } else {
                x.innerHTML = "Locked off";
                websocket.send(JSON.stringify({ LOCKEDBUOY1: false }));
            }
        }

        function myFunctionRemote1() {
            var x = document.getElementById("Remote_Buoy_1");
            if (x.innerHTML === "Remote off") {
                x.innerHTML = "Remote on";
                websocket.send(JSON.stringify({ REMOTEBUOY1: true }));

                var x = document.getElementById("LOOK_Buoy_1");
                x.innerHTML = "Locked off";
                var x = document.getElementById("Doc_Buoy_1");
                x.innerHTML = "Doc off";

            } else {
                x.innerHTML = "Remote off";
                websocket.send(JSON.stringify({ REMOTEBUOY1: false }));
            }
        }

        function myFunctionDoc1() {
            var x = document.getElementById("Doc_Buoy_1");
            if (x.innerHTML === "Doc off") {
                x.innerHTML = "Doc on";
                websocket.send(JSON.stringify({ DOCBUOY1: true }));

                var x = document.getElementById("LOOK_Buoy_1");
                x.innerHTML = "Locked off";
                var x = document.getElementById("Remote_Buoy_1");
                x.innerHTML = "Remote off";

            } else {
                x.innerHTML = "Doc off";
                websocket.send(JSON.stringify({ DOCBUOY1: false }));
            }
        }

        function Rudder1(t) {
            websocket.send(JSON.stringify({ Rudder1: t }));
        }

        function Speed1(t) {
            websocket.send(JSON.stringify({ Speed1: t }));
        }

        function toStatus(txt) {
            document.getElementById("status").innerHTML = txt;
        }
    </script>
</body>

</html>